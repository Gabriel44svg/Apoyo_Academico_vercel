{% extends 'base.html' %}

{% block title %}Generador de Gráficas - Portal Académico{% endblock %}

{% block content %}
<div class="generador-container" style="display: flex; gap: 20px; flex-wrap: wrap;">
    
    <div class="editor-panel" style="flex: 1; min-width: 300px;">
        <div class="info-box" style="margin-bottom: 20px;">
            <h2><span style="color:#d1a938;">///</span> Editor Python</h2>
            <p>Escriba su código usando <code>matplotlib.pyplot</code> y <code>numpy</code>.</p>
        </div>

        <form method="post">
            {% csrf_token %}
            <textarea name="codigo" 
                      style="width: 100%; height: 400px; background: #2d2d2d; color: #f8f8f2; font-family: 'Courier New', monospace; padding: 15px; border-radius: 5px; border: none;"
                      spellcheck="false">{{ codigo }}</textarea>
            
            <button type="submit" 
                    style="margin-top: 15px; background-color: #27ae60; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; width: 100%;">
                ▶ Ejecutar y Generar Gráfica
            </button>
        </form>
        
        {% if error %}
        <div style="background: #e74c3c; color: white; padding: 10px; margin-top: 15px; border-radius: 5px;">
            <strong>Error:</strong> {{ error }}
        </div>
        {% endif %}
    </div>

    <div class="visualizador-panel" style="flex: 1; min-width: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f9f9f9; border: 2px dashed #ccc; border-radius: 8px;">
        
        {% if imagen_grafica %}
            <h3 style="color: #333;">Resultado Generado:</h3>
            <img src="data:image/png;base64,{{ imagen_grafica }}" alt="Gráfica Generada" style="max-width: 100%; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
            
            <a href="data:image/png;base64,{{ imagen_grafica }}" download="grafica_portal.png" 
               style="margin-top: 20px; color: #004e90; text-decoration: underline;">
               ⬇ Descargar Imagen
            </a>
        {% else %}
            <div style="text-align: center; color: #999;">
                <p style="font-size: 3em; margin: 0;">GRAFICAFORA</p>
                <p>Ejecuta el código para ver el resultado aquí.</p>
            </div>
        {% endif %}
    </div>

</div>
{% endblock %}